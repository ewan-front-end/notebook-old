<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
</html>
<script>
    let block = `
    :::2021.06.27:::

===+
[####](bd) 入门部署
> notebook
notebook> npm init -y
notebook> npm install vuepress --save-dev
notebook/docs/
notebook/docs/README.md 
    [#]{color: #f00; font-size: 14px}(bd) Hello VuePress
notebook> vuepress dev docs
    http://localhost:8080


===-
    `
    

    const REG_STYLE = `(\\{(?<style>[\\w\\s-;:'"#]+)\\})?` // color: #f00; font-size: 14px
    const REG_CLASS = `(\\((?<className>[\\w\\s-]+)\\))?`  // bd sz-16 c-0
    

    function arrayToRegExp(arr) {
        function handleKey(e) {
            if (typeof e === 'string') return e
            
            if (Object.prototype.toString.call(e) === '[object Array]') {
                let str = ``
                e.forEach(o => {
                    if (typeof o === 'string') {
                        str += o
                    } else {
                        str += handleKey(o)
                    }
                })
                return `(${str})` 
            } else {
                let str = `(?`
                for (let i in e) {
                    str += `<${i}>`
                    if (typeof e[i] === 'string') {
                        str += e[i]
                    } else {
                        str += arrayToRegExp(e[i])
                    }
                }
                return str + `)`
            }        
        }
        let regStr = ``
        arr.forEach(item => { regStr += handleKey(item) })
        return regStr        
    }

  
    REG_TIT = new RegExp(arrayToRegExp([
        `\\x20*`,          // 0任意空格
        {format: [
            {isInvert: `\\[?`}, // 是否反相
            {level: `#{1,6}`},
            `\\]?`,
            REG_STYLE,
            REG_CLASS,
            `\\s`,
            {text: `[^\\n\\r\\{]+`}
        ]}
    ]))

    
    let listMatch    
    while ((listMatch = REG_TIT.exec(block)) !== null) {
        let {format, isInvert, level, style, className, text} =  listMatch.groups   
        console.log('format', format);
        console.log('isInvert', isInvert);
        console.log('level', level);
        console.log('style', style);
        console.log('className', className);
        console.log('text', text);
        
        let classStr = `h${level.length}`
        if (isInvert) {
            classStr += ' bg3 cf'
            if (text[0] !== ' ') text = ' ' + text
            if (text[text.length-1] !== ' ') text = text + ' '
        } 
        let str = `class="${classStr}"`, content = text
        if (style) {
            str += ` style="${style}"`
            content = content.replace(/\{([\w\s-;:'"#]+)\}/, '')
        }        
        block = block.replace(format, `<span ${str}>${content}</span>`)
    }
    console.log(block);

</script>