<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="app"></div>
    <span style="color:#eee">\x20*</span>
    <span style="color:#00f">(?&lt;format&gt;(?&lt;isInvert&gt;\[?)(?&lt;level&gt;#{1,6})\]?(\{(?&lt;style&gt;[\w\s-;:'"#]+)\})?(\((?&lt;className&gt;[\w\s-]+)\))?\s(?&lt;text&gt;[^\n\r\{]+))</span>
</body>
</html>
<script>
    let block = `
    :::2021.06.27:::

===+
[####](bd) 入门部署
> notebook
notebook> npm init -y
notebook> npm install vuepress --save-dev
notebook/docs/
notebook/docs/README.md 
    [#]{color: #f00; font-size: 14px}(bd) Hello VuePress
notebook> vuepress dev docs
    http://localhost:8080


===-
    `
    
    
    const REG_STYLE = `(\\{(?<style>[\\w\\s-;:'"#]+)\\})?` // color: #f00; font-size: 14px
    const REG_CLASS = `(\\((?<className>[\\w\\s-]+)\\))?`  // bd sz-16 c-0
    
    function htmlEscape(content) {
        return content.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
    }
    function arrayToRegExp(arr) {
        function handleKey(e) {
            if (typeof e === 'string') {
                //console.log('%c ' + e,'color:#ccc')
                return {
                    value: e,
                    html: `【span style="color:#eee"】${e}【/span】`
                }
            }
            
            if (Object.prototype.toString.call(e) === '[object Array]') {
                let str = ``
                e.forEach(o => {
                    if (typeof o === 'string') {
                        str += o
                    } else {
                        str += handleKey(o)
                    }
                })
                return {
                    value: `(${str})`,
                    html: `【span style="color:#0f0"】(${str})【/span】`
                } 
            } else {
                let str = `(?`
                for (let i in e) {
                    str += `<${i}>`
                    if (typeof e[i] === 'string') {
                        str += e[i]
                    } else {
                        str += arrayToRegExp(e[i]).value
                    }
                }
                str += `)`
                console.log(str);
                return {
                    value: str,
                    html: `【span style="color:#00f"】${str}【/span】`
                }
            }        
        }
        let value = ``, html = ``
        arr.forEach(item => { 
            let res = handleKey(item)
            value += res.value 
            html += res.html
        })
        return {
            value,
            html: htmlEscape(html).replace(/【/g, '<').replace(/】/g, '>')
        }       
    }
    const regStr = arrayToRegExp([
        `\\x20*`,          // 0任意空格
        {format: [
            {isInvert: `\\[?`}, // 是否反相
            {level: `#{1,6}`},
            `\\]?`,
            REG_STYLE,
            REG_CLASS,
            `\\s`,
            {text: `[^\\n\\r\\{]+`}
        ]}
    ])
    console.log(regStr.html);
    document.querySelector('#app').innerHTML = regStr.html
  
    REG_TIT = new RegExp(regStr.value)
// (\{(?<style>[\w\s-;:'"#]+)\})?(\
    
    let listMatch    
    while ((listMatch = REG_TIT.exec(block)) !== null) {
        let {format, isInvert, level, style, className, text} =  listMatch.groups   
        console.log('format', format);
        console.log('isInvert', isInvert);
        console.log('level', level);
        console.log('style', style);
        console.log('className', className);
        console.log('text', text);
        
        let classStr = `h${level.length}`
        if (isInvert) {
            classStr += ' bg3 cf'
            if (text[0] !== ' ') text = ' ' + text
            if (text[text.length-1] !== ' ') text = text + ' '
        } 
        let str = `class="${classStr}"`, content = text
        if (style) {
            str += ` style="${style}"`
            content = content.replace(/\{([\w\s-;:'"#]+)\}/, '')
        }        
        block = block.replace(format, `<span ${str}>${content}</span>`)
    }
    console.log(block);

</script>