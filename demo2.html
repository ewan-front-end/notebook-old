<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        

        .obj-tree{ color: #333;}        
        .obj-tree .node{ font-size: 14px; line-height: 16px; padding-left: 18px; border-left:#eee 1px solid; }
        .obj-tree .node .title{ position: relative; z-index: 1; padding-left: 4px;}
        .obj-tree .node .title i{font-style: normal; vertical-align: bottom;}
        .obj-tree .node .title i.del{text-decoration: line-through}
        .obj-tree .node .title i.important{font-weight: bold;}
        /* 值类型 */
        .obj-tree .node .title i.string{color:#ccc}
        .obj-tree .node .title i.string:before{content:'"'}
        .obj-tree .node .title i.string:after{content:'"'}
        .obj-tree .node .title i.number{color:#ccc}

        .obj-tree .node .title i.link,
        .obj-tree .node .title i.warn,
        .obj-tree .node .title i.hard,
        .obj-tree .node .title i.desc,
        .obj-tree .node .title i.parm{
            width: 0; height: 16px; line-height: 16px; cursor: pointer; padding-left: 12px; margin-left: 5px; overflow: hidden; display: inline-block;
            background-image: url('./docs/.usage/resources/images/obj-tree-12.png'); background-repeat: no-repeat; font-size: 12px;
        }
        /* 链接 */
        .obj-tree .node .title i.link{color: #ffb863; background-position: -60px center;}
        .obj-tree .node .title i.link:hover{width: auto; padding-left: 0; overflow: visible; background: none;}
        .obj-tree .node .title i.link a{ color: #49d199; line-height: 16px; margin: 0 5px; text-decoration: none; }
        /* 警告 */
        .obj-tree .node .title i.warn{color: #ffb863; background-position:-48px center;}
        .obj-tree .node .title i.warn:hover{width: auto; padding-left: 0; overflow: visible; background: none;}
        .obj-tree .node .title i.warn a{ color: #ffa842; line-height: 16px; margin: 0 5px; text-decoration: none }
        /* 疑难 */
        .obj-tree .node .title i.hard{color: #cd8cff; background-position:-36px center;}
        .obj-tree .node .title i.hard:hover{width: auto; padding-left: 0; overflow: visible; background: none;}
        .obj-tree .node .title i.hard a{ color: #c072ff; line-height: 16px; margin: 0 5px; text-decoration: none;}
        /* 详情 */
        .obj-tree .node .title i.desc{color: #ccc; background-position:-24px center;} 
        .obj-tree .node .title i.desc:hover{width: auto; padding-left: 0; overflow: visible; background: none;}
        /* 方参 */
        .obj-tree .node .title i.parm{color: #ccc; background-position:left center;} 
        .obj-tree .node .title i.parm:hover{width: auto; padding-left: 0; overflow: visible; background: none;}


        /* 复合节点 */
        .obj-tree .node.mult{}
        .obj-tree .node.mult > span:before{ 
            position: absolute; bottom: 0; left: -15px;
            content: ''; display: inline-block; width: 16px; height: 16px;
            background-image: url('./docs/.usage/resources/images/obj-tree-16.png');
            background-repeat: no-repeat;
            background-position: -12px 0;
            background-color: #eee;  
            background-position: -16px 0;          
            vertical-align: middle;  
            cursor: pointer;          
        }
        .obj-tree .node.pinch > .title:before{background-position: 0 0;}
        .obj-tree .node.pinch > .children{height: 0; overflow: hidden;}
        /* 类型：属性节点 */
        .obj-tree .node.attr > .title{ color: #999; }
        /* 类型：方法节点 */
        .obj-tree .node.method > .title{ color: #d98c8c; }
        /* .obj-tree .node.method > span:before{ content: 'ƒ ' } */


        body{position: relative; z-index: 1; padding: 0; margin: 0;}
        .snap-windows-wrapper{ 
            height: 1vh; 
            border:#eee 1px solid; background-color: #f9f9f9; 
            font-size: 12px;
            position: fixed; z-index: 10000;
            padding: 20px 10px;
            box-sizing: border-box;
        }
        .snap-windows-wrapper.snap-top{top: 0; right:0; left: 0}
        .snap-windows-wrapper.snap-right{top: 0; right:0; bottom: 0; height: 100vh;}
        .snap-windows-wrapper.snap-bottom{left: 0; right:0; bottom: 0}
        .snap-windows-wrapper.snap-left{top: 0; left:0; bottom: 0; height: 100vh;}
        .hidd-container{
            border:#ccc 1px solid;
            max-width: 800px; height: 90vh;
            overflow: auto;
        }
        .html-container{
            border:#f00 1px solid;
        }
        .code-container{
            border:#0f0 1px solid;
        }
    </style>
</head>
<body>
    <div class="side-retractable-window" id="side-retractable-window"></div>
    <div class="wrapper"></div>
    https://segmentfault.com/a/1190000014212576
    
</body>
</html>
<script src="test.js"></script>
<script>
class SnapWindows{    
    constructor(options) {
        const wrapper = document.createElement('div'), 
            hiddContainer = document.createElement('div'),
            htmlContainer = document.createElement('div'), 
            codeContainer = document.createElement('pre')
        const defaultOptions = {
            where: 'right'
        }
        Object.assign(defaultOptions, options)
                
        wrapper.className = `snap-windows-wrapper snap-${defaultOptions.where}`
        hiddContainer.className = 'hidd-container'
        htmlContainer.className = 'html-container'
        codeContainer.className = 'code-container'
        hiddContainer.appendChild(htmlContainer)
        hiddContainer.appendChild(codeContainer)   
        wrapper.appendChild(hiddContainer)     
        document.body.appendChild(wrapper)
        this.htmlContainer = htmlContainer
        this.codeContainer = codeContainer
    }
    setHTML(html) {
        this.htmlContainer.innerHTML = html
    }
    setCode(code) {
        this.codeContainer.innerHTML = code
    }
}
const sideWin = new SnapWindows({
    
}) 
//document.querySelector('#side-retractable-window').innerHTML = item.content

</script>
<script>

Element.prototype.addClass = function(cn) {
    let className = this.className
    if (className.indexOf(cn) > -1) return this
    className = (className + ' ' + cn).replace(/\s+/g, ' ')
    this.className = className
    return this
}
Element.prototype.delClass = function(cn) {
    let className = this.className
    if (className.indexOf(cn) < 0) return this
    className = className.replace(cn, '').replace(/\s{2,}/g, ' ')
    this.className = className
    return this
}
Element.prototype.hasClass = function(cn) {
    return this.className.indexOf(cn) > -1
}
String.prototype.addClass = function(cn) {
    if (this.indexOf(cn) > -1) return this
    return (this + ' ' + cn).replace(/\s{2,}/g, ' ')
}
String.prototype.delClass = function(cn) {
    if (this.indexOf(cn) < 0) return this
    return this.replace(cn, '').replace(/\s{2,}/g, ' ')
}

function handleNode(key, node, type){
    let nodeClass = 'node', 
        title = key, 
        detail =  '',  
        children = ''
    let isPinch = node.PINCH_CHILDREN || false
    // 节点闭合    
    node.PINCH_ALL && (window.pinchAll = true)
    // Object / String Number
    if (typeof node === 'object') {  
        if (node.VALUE) {
            nodeClass += ' attr'; 
            detail = ` : <i class="${typeof node.VALUE}">${node.VALUE}</i>` + detail
        }  
           
        if (type === 'method') {
            nodeClass += ' ' + type   
            if (node.PARAMETERS || node.RETURNS) detail += `<i class="parm">${ (node.PARAMETERS ? `(${node.PARAMETERS})` : '()') + (node.RETURNS ? `: ${node.RETURNS}` : `: void`)}</i>`
        }        
        if (node.ATTRIBUTE) children += Object.keys(node.ATTRIBUTE).map(i => handleNode(i, node.ATTRIBUTE[i])).join('')
        if (node.METHODS) children += Object.keys(node.METHODS).map(i => handleNode(i, node.METHODS[i], 'method')).join('')
        if (node.ATTRIBUTE || node.METHODS) {
            nodeClass = nodeClass.addClass('mult')
            if (window.pinchAll || isPinch) nodeClass = nodeClass.addClass('pinch')
            children = `<div class="children">${children}</div>` 
        }
        if (node.DESC) detail += `<i class="desc">${node.DESC}</i>`
        if (node.LINK || node.LINK_IN) {
            let links = node.LINK ? node.LINK.map(e => `<a href="${e.href}">${e.title}</a>`).join('') : ''
            node.LINK_IN && (links += node.LINK_IN.map(e => `<a href="javascript:linkInner('${e}')">${InternalLinks[e].title}</a>`).join(''))
            detail += `<i class="link">${links}</i>`
        } 
        if (node.HARD) detail += `<i class="hard">${node.HARD.map(e => `<a href="${e.href}">${e.title}</a>`).join('')}</i>`        
        if (node.WARN) detail += `<i class="warn">${node.WARN.map(e => `<a href="${e.href}">${e.title}</a>`).join('')}</i>`
    } else {
        nodeClass += ' attr'
        detail = ` : <i class="${typeof node}">${node}</i>` + detail
    }

    node.DEPRECATED && (title = `<i class="del">${title}</i>`)
    node.IMPORTANT && (title = `<i class="important">${title}</i>`)
    title = `<span class="title">${title}${detail}</span>`
    return `<div class="${nodeClass}">${title}${children}</div>`
}  

let htmlStr = `<div id="obj-tree" class="obj-tree">${handleNode(treeObj.TITLE, treeObj)}<div class="content"></div></div>`
document.querySelector('.wrapper').innerHTML = htmlStr
document.addEventListener('click', e => {
    let parent = e.target.parentNode, parentClass = parent.className || ''
    if (parentClass.includes('node mult')) {
        parentClass = parentClass.includes('pinch') ? parentClass.delClass('pinch') : parentClass.addClass('pinch') 
        parent.className = parentClass       
    }
}) 
function linkInner(key) {
    let item = InternalLinks[key]
    sideWin.setCode(item.content)
}
sideWin.setCode(InternalLinks['url'].content)

</script>