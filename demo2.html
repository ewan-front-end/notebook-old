<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .obj-tree{ color: #333;}
        .obj-tree .node{ 
            font-size: 12px;
            line-height: 16px;
            padding-left: 18px; 
            border-left:#eee 1px solid;
        }
        .obj-tree .node span{ position: relative; z-index: 1; padding-left: 4px;}
        .obj-tree .node span i{font-style: normal; vertical-align: bottom;}
        /* 值类型 */
        .obj-tree .node span i.string{color:#ccc}
        .obj-tree .node span i.string:before{content:'"'}
        .obj-tree .node span i.string:after{content:'"'}
        .obj-tree .node span i.number{color:#e91; } 
        /* 详情 */
        .obj-tree .node span i.parameter{  
            width: 0; height: 16px; padding-left: 12px; margin-left: 5px; overflow: hidden; display: inline-block; 
            background: url('./docs/.usage/resources/images/obj-tree-12.png') left center no-repeat; cursor: pointer;
        } 
        .obj-tree .node span i.parameter:hover{width: auto; padding-left: 0; overflow: auto; background: none;}

        .obj-tree .node span i.desc{
            width: 0; height: 16px; padding-left: 12px; margin-left: 5px; overflow: hidden; display: inline-block; color: #999; 
            background: url('./docs/.usage/resources/images/obj-tree-12.png') -24px center no-repeat; cursor: pointer;
        }
        .obj-tree .node span i.desc:hover{width: auto; padding-left: 0; overflow: auto; background: none;}
        .obj-tree .node span i.hard{
            width: 0; height: 16px; padding-left: 12px; margin-left: 5px; overflow: hidden; display: inline-block; color: #cd8cff; 
            background: url('./docs/.usage/resources/images/obj-tree-12.png') -36px center no-repeat; cursor: pointer;
        }
        .obj-tree .node span i.hard:hover{width: auto; padding-left: 0; overflow: auto; background: none;}
        .obj-tree .node span i.warn{
            width: 0; height: 16px; padding-left: 12px; margin-left: 5px; overflow: hidden; display: inline-block; color: #ffb863; 
            background: url('./docs/.usage/resources/images/obj-tree-12.png') -48px center no-repeat; cursor: pointer;
        }
        .obj-tree .node span i.warn:hover{width: auto; padding-left: 0; overflow: auto; background: none;}
        .obj-tree .node span i.link{
            width: 0; height: 16px; padding-left: 12px; margin-left: 5px; overflow: hidden; display: inline-block; color: #ffb863; 
            background: url('./docs/.usage/resources/images/obj-tree-12.png') -60px center no-repeat; cursor: pointer;
        }
        .obj-tree .node span i.link:hover{width: auto; padding-left: 0; overflow: visible; background: none;}


        /* 复合节点 */
        .obj-tree .node.mult{}
        .obj-tree .node.mult > span:before{ 
            position: absolute; bottom: 0; left: -15px;
            content: ''; display: inline-block; width: 16px; height: 16px;
            background-image: url('./docs/.usage/resources/images/obj-tree-16.png');
            background-repeat: no-repeat;
            background-position: -12px 0;
            background-color: #eee;  
            background-position: -16px 0;          
            vertical-align: middle;  
            cursor: pointer;          
        }
        .obj-tree .node.pinch > span:before{background-position: 0 0;}
        .obj-tree .node.pinch > div.children{height: 0; overflow: hidden;}
        /* 类型：属性节点 */
        .obj-tree .node.attr > span{
            color: #999;
        }
        /* 类型：方法节点 */
        .obj-tree .node.method > span{ color: #e91; }
        /* .obj-tree .node.method > span:before{ content: 'ƒ ' } */
    </style>
</head>
<body>
    <div class="wrapper"></div>
    https://segmentfault.com/a/1190000014212576
    
</body>
</html>
<script src="test.js"></script>
<script>

Element.prototype.addClass = function(cn) {
    let className = this.className
    if (className.indexOf(cn) > -1) return this
    className = (className + ' ' + cn).replace(/\s+/g, ' ')
    this.className = className
    return this
}
Element.prototype.delClass = function(cn) {
    let className = this.className
    if (className.indexOf(cn) < 0) return this
    className = className.replace(cn, '').replace(/\s{2,}/g, ' ')
    this.className = className
    return this
}
Element.prototype.hasClass = function(cn) {
    return this.className.indexOf(cn) > -1
}
String.prototype.addClass = function(cn) {
    if (this.indexOf(cn) > -1) return this
    return (this + ' ' + cn).replace(/\s{2,}/g, ' ')
}
String.prototype.delClass = function(cn) {
    if (this.indexOf(cn) < 0) return this
    return this.replace(cn, '').replace(/\s{2,}/g, ' ')
}

function handleNode(key, node, type){
    let nodeClass = 'node', title = '', value = '', detail =  '', children = ''
    let isPinch = node.PINCH_CHILDREN || false
    // 节点闭合    
    node.PINCH_ALL && (window.pinchAll = true)
    // Object / String Number
    if (typeof node === 'object') {        
        if (type === 'method') {
            nodeClass += ' ' + type   
            if (node.PARAMETERS || node.RETURNS) detail += `<i class="parameter">${ (node.PARAMETERS ? `(${node.PARAMETERS})` : '()') + (node.RETURNS ? `: ${node.RETURNS}` : `: void`)}</i>`
        }
        if (node.ATTRIBUTE) {
            let attribute = ''
            for (let i in node.ATTRIBUTE) {attribute += `${handleNode(i, node.ATTRIBUTE[i])}`}
            children += attribute
        } 
        if (node.METHODS) {
            let methods = ''
            for (let i in node.METHODS) {methods += `${handleNode(i, node.METHODS[i], 'method')}`}
            children += methods
        }
        if (node.ATTRIBUTE || node.METHODS) {
            nodeClass = nodeClass.addClass('mult')
            if (window.pinchAll || isPinch) nodeClass = nodeClass.addClass('pinch')
            children = `<div class="children">${children}</div>` 
        }
        if (node.DESC) detail += `<i class="desc">${node.DESC}</i>`
        if (node.LINK || node.LINK_IN) {
            let links = ''
            node.LINK && node.LINK.forEach(e => {links += `<a href="${e.href}">${e.title}</a>`})
            node.LINK_IN && node.LINK_IN.forEach(e => {
                links += `<a href="${e.href}">${e.title}</a>`
            })
            detail += `<i class="link">${links}</i>`
        } 
        if (node.HARD) {
            let hards = ''
            node.HARD.forEach(e => {hards += `<a href="${e.href}">${e.title}</a>`})
            detail += `<i class="hard">${hards}</i>`
        } 
        if (node.WARN) {
            let warns = ''
            node.WARN.forEach(e => {warns += `<a href="${e.href}">${e.title}</a>`})
            detail += `<i class="warn">${warns}</i>`
        } 
        
    } else {
        value = ` : <i class="${typeof node}">${node}</i>`
        nodeClass += ' attr'
    }
     
    title = `<span>${key}${value}${detail}</span>`
    return `<div class="${nodeClass}">${title}${children}</div>`
}  

let htmlStr = `<div class="obj-tree">${handleNode(treeObj.TITLE, treeObj)}</div>`
document.querySelector('.wrapper').innerHTML = htmlStr
document.addEventListener('click', e => {
    let parent = e.target.parentNode, parentClass = parent.className || ''
    if (parentClass.includes('node mult')) {
        parentClass = parentClass.includes('pinch') ? parentClass.delClass('pinch') : parentClass.addClass('pinch') 
        parent.className = parentClass       
    }
}) 


</script>